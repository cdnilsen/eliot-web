<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Synapdeck</title>
    <link href="https://fonts.googleapis.com/css2?family=Jost:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="./synapdeck_styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <h1>Welcome to Synapdeck!</h1>
        <div class="button-row">
            <button type="button" id="upload_cards" class="active">Upload Card Data</button>
            <button type="button" id="shuffle_cards">Shuffle Cards</button>
            <button type="button" id="browse_cards">Browse Cards</button>
            <button type="button" id="review_cards">Do Reviews</button>
            <button type="button" id="check_work">Check Your Work</button>
            <button type="button" id="forecast_cards">Review Forecast</button>
        </div>

        <div id="upload_mainDiv" class="tab-content active">
            <h2>Upload Cards</h2>
            <!-- Radio button selection for input method -->
            <div class="input-method-selection">
                <h3>Choose input method:</h3>
                <div class="radio-buttons-row">
                    <label>
                        <input type="radio" name="inputMethod" value="file" id="fileInputRadio" checked>
                        Upload from file
                    </label>
                    <label>
                        <input type="radio" name="inputMethod" value="text" id="textInputRadio">
                        Type cards directly
                    </label>
                </div>
            </div>

            <label for="upload_dropdownMenu">Choose a deck:</label>
            <select id="upload_dropdownMenu" name="upload_dropdownMenu">
                <option value="" disabled selected>(None)</option>
            </select>

            <div id="cardFormatSection">
                <label for="card_format_dropdown">Choose card type (more coming soon):</label>
                <select id="card_format_dropdown" name="card_type_dropdown">
                    <option value="two-way">Two-way card</option>
                    <option value="one-way-T2N">One-way (Target to Native)</option>
                    <option value="one-way-N2T">One-way (Native to Target)</option>
                </select>
            </div>
            
            <!-- File upload section -->
            <div class="upload_input-group" id="fileUploadSection">
                <label for="uploadTextFile">Upload Text File:</label>
                <input type="file" id="uploadTextFile" accept=".txt">
            </div>

            <!-- Text input section -->
            <div class="text_input-group" id="textInputSection" style="display: none;">
                <label for="cardTextInput">Type your cards (follow the format examples above):</label>
                <textarea id="cardTextInput" rows="10" cols="50" placeholder="Enter your cards here following the format:&#10;näbärä / to sit / näbärä&#10;hägär / city / hägär"></textarea>
                <!-- Special characters panel will be inserted here dynamically by JavaScript -->
            </div>
            
            <div class="button-group">
                <button id="upload_submitBtn" class="hidden">Submit</button>
                <button id="upload_cancel" class="hidden">Cancel</button>
            </div>
            <br>
            <br>
            <div class="review-options">
                <button type="button" id="wipeDatabaseButton" style="background: red; color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer;">
                    &#10003; Wipe the database
                </button>
            </div>
            
            <div id="upload_output"></div>
        </div>

        <div id="shuffle_mainDiv" class="tab-content">
            <h2>Shuffle Card Due Dates</h2>
            <p>Randomly redistribute the due dates of cards within a specified time period to spread out reviews more evenly.</p>
    
            <div class="date-shuffle-form">
                <div class="input-group">
                    <label for="shuffleDeckSelect">Select Deck:</label>
                    <select id="shuffleDeckSelect">
                        <option value="">Choose a deck...</option>
                        <option value="Ge'ez">Ge'ez</option>
                        <option value="Ancient Greek">Ancient Greek</option>
                        <option value="Sanskrit">Sanskrit</option>
                        <option value="Akkadian">Akkadian</option>
                        <option value="Hebrew">Hebrew</option>
                        <option value="Tocharian B">Tocharian B</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="shuffleDaysSpan">Time Span (days):</label>
                    <input type="number" id="shuffleDaysSpan" min="1" max="365" value="7" placeholder="Number of days">
                    <small>Cards will be randomly distributed across this many days</small>
                </div>
                
                <div class="input-group">
                    <label for="shuffleBaseDate">Starting Date:</label>
                    <input type="date" id="shuffleBaseDate">
                    <small>Leave blank to start from today</small>
                </div>
                
                <div class="input-group">
                    <label>
                        <input type="checkbox" id="includeOverdueCards">
                        Include overdue cards in shuffle
                    </label>
                    <small>If checked, includes cards that are already overdue</small>
                </div>
                
                <div class="button-group">
                    <button id="executeDateShuffleBtn" class="btn">Shuffle Due Dates</button>
                </div>
            </div>
    
            <div id="shuffle_output" class="output-section">
                Select a deck and configure options above to shuffle due dates.
            </div>
        </div>

        <div id="forecast_mainDiv" class="tab-content">
            <h2>Review Forecast</h2>
            <p>View projected review workload across different decks over the coming days.</p>
            
            <div class="forecast-controls">
                <div class="control-group">
                    <label for="forecastDays">Forecast Period:</label>
                    <select id="forecastDays">
                        <option value="7">7 days</option>
                        <option value="14" selected>14 days</option>
                        <option value="21">21 days</option>
                        <option value="30">30 days</option>
                    </select>
                </div>
                
                <div class="deck-selection-group">
                    <h4>Select Decks to Display:</h4>
                    <div id="deckSelection">
                        <!-- Deck checkboxes will be populated by JavaScript -->
                    </div>
                </div>
            </div>
            
            <div id="forecastLoading" class="loading-message" style="display: none;">
                Loading forecast data...
            </div>
            
            <div id="forecastError" class="error-message" style="display: none;">
                <!-- Error messages will appear here -->
            </div>
            
            <div class="chart-container">
                <canvas id="reviewForecastChart" width="800" height="400"></canvas>
            </div>
            
            <div id="forecastStats" class="forecast-stats" style="display: none;">
                <!-- Statistics will appear here -->
            </div>
        </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/3.0.1/jspdf.umd.min.js"></script>
    <script>
        // Make jsPDF available to your module
        window.jsPDF = window.jspdf.jsPDF;
        console.log('jsPDF available:', typeof window.jsPDF);

        // Handle radio button changes to show/hide appropriate input sections
        document.addEventListener('DOMContentLoaded', function() {
            const fileRadio = document.getElementById('fileInputRadio');
            const textRadio = document.getElementById('textInputRadio');
            const fileSection = document.getElementById('fileUploadSection');
            const textSection = document.getElementById('textInputSection');
            const submitBtn = document.getElementById('upload_submitBtn');
            const cancelBtn = document.getElementById('upload_cancel');

            function toggleInputSections() {
                if (fileRadio.checked) {
                    fileSection.style.display = 'block';
                    textSection.style.display = 'none';
                } else if (textRadio.checked) {
                    fileSection.style.display = 'none';
                    textSection.style.display = 'block';
                }
                
                // Show submit and cancel buttons when either input method is selected
                if (fileRadio.checked || textRadio.checked) {
                    submitBtn.classList.remove('hidden');
                    cancelBtn.classList.remove('hidden');
                }
            }

            fileRadio.addEventListener('change', toggleInputSections);
            textRadio.addEventListener('change', toggleInputSections);

            // Initialize the display
            toggleInputSections();
        });
        
        import('./synapdeck.js')
            .then(() => {
                console.log('synapdeck.js loaded successfully');
            })
            .catch(error => {
                console.error('Failed to load synapdeck.js:', error);
            });
    </script>
</body>
</html>