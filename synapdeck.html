<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Synapdeck</title>
    <link href="https://fonts.googleapis.com/css2?family=Jost:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="./synapdeck_styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
</head>
<body>
    <div class="container">
        <h1>Welcome to Synapdeck!</h1>
        <div class="button-row">
            <button type="button" id="upload_cards" class="active">Upload Card Data</button>
            <button type="button" id="shuffle_cards">Shuffle Cards</button>
            <button type="button" id="browse_cards">Browse Cards</button>
            <button type="button" id="review_cards">Do Reviews</button>
            <button type="button" id="check_work">Check Your Work</button>
            <button type="button" id="forecast_cards">Review Forecast</button>
            <button type="button" id="stats_cards">Stats</button>
        </div>

        <div id="upload_mainDiv" class="tab-content active">
            <h2>Upload Cards</h2>
            <label for="upload_dropdownMenu">Choose a deck:</label>
            <select id="upload_dropdownMenu" name="upload_dropdownMenu">
                <option value="" disabled selected>(None)</option>
            </select>

            <div id="cardFormatSection">
                <label for="card_format_dropdown">Choose card type (more coming soon):</label>
                <select id="card_format_dropdown" name="card_type_dropdown">
                    <option value="two-way">Two-way card</option>
                    <option value="one-way-N2T">One-way (Front/Back)</option>
                </select>
            </div>

            <div id="initialIntervalSection" style="margin: 8px 0;">
                <label for="initialIntervalInput" style="display: inline; font-size: 14px; font-weight: 500; color: #555;">Initial interval (days):</label>
                <input type="number" id="initialIntervalInput" min="1" value="1" style="width: 60px; margin-left: 6px; padding: 4px 8px; border: 1px solid #ced4da; border-radius: 4px; font-size: 13px;">
            </div>

            <!-- Spreadsheet input section -->
            <div class="spreadsheet_input-group" id="spreadsheetSection">
                <div id="cardSpreadsheet" class="card-spreadsheet-container">
                    <!-- Table built dynamically by JavaScript -->
                </div>
                <button type="button" id="addSpreadsheetRow">+ Add 5 Rows</button>
                <!-- Special characters panel will be appended here by JavaScript when this mode is active -->
            </div>
            
            <div class="button-group">
                <button id="upload_submitBtn" class="hidden">Submit</button>
                <button id="upload_cancel" class="hidden">Cancel</button>
            </div>
            <div style="margin-top: 8px;">
                <label style="font-size: 14px; cursor: pointer;">
                    <input type="checkbox" id="markAllPeers" style="margin-right: 6px;">
                    Mark all created cards as peers of each other
                </label>
            </div>
            <br>
            <br>
            <div class="review-options">
                <button type="button" id="wipeDatabaseButton" style="background: red; color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer;">
                    &#10003; Wipe the database
                </button>
            </div>
            
            <div id="upload_output"></div>
        </div>

        <div id="shuffle_mainDiv" class="tab-content">
            <h2>Shuffle Card Due Dates</h2>
            <p>Randomly redistribute the due dates of cards within a specified time period to spread out reviews more evenly.</p>
    
            <div class="date-shuffle-form">
                <div class="input-group">
                    <label for="shuffleDeckSelect">Select Deck:</label>
                    <select id="shuffleDeckSelect">
                        <option value="">Choose a deck...</option>
                        <option value="Ge'ez">Ge'ez</option>
                        <option value="Ancient Greek">Ancient Greek</option>
                        <option value="Sanskrit">Sanskrit</option>
                        <option value="Akkadian">Akkadian</option>
                        <option value="Hebrew">Hebrew</option>
                        <option value="Tocharian B">Tocharian B</option>
                    </select>
                </div>
                
                <div class="input-group">
                    <label for="shuffleDaysSpan">Time Span (days):</label>
                    <input type="number" id="shuffleDaysSpan" min="1" max="365" value="7" placeholder="Number of days">
                    <small>Cards will be randomly distributed across this many days</small>
                </div>
                
                <div class="input-group">
                    <label for="shuffleBaseDate">Starting Date:</label>
                    <input type="date" id="shuffleBaseDate">
                    <small>Leave blank to start from today</small>
                </div>
                
                <div class="input-group">
                    <label>
                        <input type="checkbox" id="includeOverdueCards">
                        Include overdue cards in shuffle
                    </label>
                    <small>If checked, includes cards that are already overdue</small>
                </div>
                
                <div class="button-group">
                    <button id="executeDateShuffleBtn" class="btn">Shuffle Due Dates</button>
                </div>
            </div>
    
            <div id="shuffle_output" class="output-section">
                Select a deck and configure options above to shuffle due dates.
            </div>
        </div>

        <div id="forecast_mainDiv" class="tab-content">
            <h2>Review Forecast</h2>
            <p>View projected review workload across different decks over the coming days.</p>
            
            <div class="forecast-controls">
                <div class="control-group">
                    <label for="forecastDays">Forecast Period:</label>
                    <select id="forecastDays">
                        <option value="7">7 days</option>
                        <option value="14" selected>14 days</option>
                        <option value="21">21 days</option>
                        <option value="30">30 days</option>
                    </select>
                </div>
                
                <div class="deck-selection-group">
                    <h4>Select Decks to Display:</h4>
                    <div id="deckSelection">
                        <!-- Deck checkboxes will be populated by JavaScript -->
                    </div>
                </div>
            </div>
            
            <div id="forecastLoading" class="loading-message" style="display: none;">
                Loading forecast data...
            </div>
            
            <div id="forecastError" class="error-message" style="display: none;">
                <!-- Error messages will appear here -->
            </div>
            
            <div class="chart-container">
                <canvas id="reviewForecastChart" width="800" height="400"></canvas>
            </div>
            
            <div id="forecastStats" class="forecast-stats" style="display: none;">
                <!-- Statistics will appear here -->
            </div>
        </div>

        <!-- Add these divs after the forecast_mainDiv -->
        <div id="review_mainDiv" class="tab-content">
            <h2>Do Reviews</h2>
            <div class="review-controls">
                <div id="review_deck_list">
                    <!-- populated by buildReviewDeckList() -->
                </div>

                <div class="review-ahead-section">
                    <label>
                        <input type="checkbox" id="reviewAheadCheckbox">
                        Review ahead
                    </label>
                    <div id="reviewAheadOptions" style="display: none;">
                        <select id="reviewAheadHours">
                            <option value="24">24 hours</option>
                            <option value="48">48 hours</option>
                            <option value="72">72 hours</option>
                        </select>
                    </div>
                </div>
                
                <button id="review_submitBtn" class="btn">Start Review</button>
                <button id="reviewDifficultBtn" class="btn btn-secondary">Review Today's Difficult Cards</button>
                <button id="resetCardReview" class="btn btn-secondary">Reset All Reviews</button>
            </div>
            <div id="review_output"></div>
        </div>

        <div id="check_mainDiv" class="tab-content">
            <h2>Check Your Work</h2>
            <div class="check-controls">
                <div class="input-group">
                    <label for="check_dropdownMenu">Select Deck:</label>
                    <select id="check_dropdownMenu" name="check_dropdownMenu">
                        <option value="" disabled selected>Select a deck</option>
                    </select>
                </div>
                <button id="check_submitBtn" class="btn">Show Answer Key</button>
            </div>
            <div id="check_output"></div>
        </div>

        <div id="stats_mainDiv" class="tab-content">
            <h2>Stats</h2>
            <div class="stats-section">
                <h3 id="cardsByDeckTitle">Cards by Deck</h3>
                <div class="pie-chart-container">
                    <canvas id="deckPieChart" width="400" height="400"></canvas>
                </div>
            </div>
            <div class="stats-section">
                <h3>Review Activity</h3>
                <div id="heatmapContainer" class="heatmap-container">
                    <!-- Heatmap will be rendered by JavaScript -->
                </div>
                <div id="heatmapTooltip" class="heatmap-tooltip" style="display:none;"></div>
            </div>
        </div>

        <div id="browse_mainDiv" class="tab-content">
            <h2>Browse Cards</h2>
            <div id="browse_results"></div>
        </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/3.0.1/jspdf.umd.min.js"></script>
    <script type="module">
        // Add this debug info
        console.log('Chart available at page load:', typeof Chart);
        console.log('Window.Chart available:', typeof window.Chart);
        
        // Wait a bit then check again
        setTimeout(() => {
            console.log('Chart available after delay:', typeof Chart);
            console.log('Window.Chart available after delay:', typeof window.Chart);
        }, 500);
        
        // Your existing code...
        import('./synapdeck.js')
            .then(() => {
                console.log('synapdeck.js loaded successfully');
                console.log('Chart available in module:', typeof Chart);
            })
            .catch(error => {
                console.error('Failed to load synapdeck.js:', error);
            });
    </script>
</body>
</html>